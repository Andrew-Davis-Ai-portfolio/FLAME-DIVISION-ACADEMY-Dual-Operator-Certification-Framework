<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Kubernetes Workflow Operator ‚Äî Level 1: Cluster Reasoning</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="apo-page">
    <!-- HEADER -->
    <header class="apo-header">
      <div class="apo-brand">
        <div class="apo-mark">KWO</div>
        <div>
          <h1>Kubernetes Workflow Operator ‚Äî Level 1</h1>
          <p>Cluster Reasoning ¬∑ Flame Division Academy</p>
        </div>
      </div>
      <div class="apo-header-actions">
        <button id="btn-tts-toggle" class="apo-btn ghost small">
          üîä TTS: ON
        </button>
        <span id="session-state" class="apo-chip">
          STATE: Scenario loaded ¬∑ Explanation unlocked
        </span>
      </div>
    </header>

    <!-- MAIN GRID -->
    <main class="apo-main">
      <!-- COLUMN 1 ‚Äî SCENARIO -->
      <section class="apo-column">
        <section class="apo-card">
          <h2>1. Read the scenario</h2>
          <p class="apo-muted small">
            Level 1 measures how clearly you can <strong>explain a Kubernetes-based system in plain language</strong>.
            No kubectl flex. No YAML dump. Just a clean mental model.
          </p>

          <div class="apo-brief-block">
            <div class="apo-brief-header">
              <h3>Scenario ‚Äî Microservice App on a Cluster</h3>
              <button id="btn-play-brief" class="apo-btn ghost small">
                ‚ñ∂ Hear scenario
              </button>
            </div>
            <p id="task-brief" class="apo-muted">
              You are responsible for a small microservice application running on a Kubernetes cluster. It has:
            </p>
            <ul id="task-criteria" class="apo-list small">
              <li>A web frontend exposed to users</li>
              <li>One or more backend services</li>
              <li>A database or stateful storage outside the pods</li>
              <li>Basic health checks and rollout strategy</li>
            </ul>
            <p class="apo-muted small" style="margin-top:0.5rem;">
              Your goal is to explain, in calm language, how this is structured in Kubernetes and where the
              main failure risks live. <strong>No YAML required.</strong>
            </p>
          </div>
        </section>

        <section class="apo-card small">
          <h3>What Level 1 is actually testing</h3>
          <ul class="apo-list small apo-muted">
            <li>Can you explain a cluster to a non-Kubernetes audience?</li>
            <li>Do you understand pods, deployments, and services as ideas, not just objects?</li>
            <li>Can you see how a rollout breaks and what users would feel?</li>
            <li>Do you think about health, not just ‚Äúit runs on my machine‚Äù?</li>
          </ul>
        </section>
      </section>

      <!-- COLUMN 2 ‚Äî EXPLANATION -->
      <section class="apo-column">
        <section class="apo-card">
          <h2>2. Write your cluster explanation</h2>
          <p class="apo-muted small">
            Explain the system as if you‚Äôre talking to a non-technical executive and an ops lead at the same time.
            No YAML. No commands. Focus on <strong>how traffic flows, how workloads are managed, and what happens when things break.</strong>
          </p>

          <label class="apo-label" for="explanation-input">
            Kubernetes system explanation
          </label>
          <textarea
            id="explanation-input"
            rows="12"
            placeholder="Example: 'Users hit a stable entry point called a Service. Behind that, multiple pods run the same app image so that if one fails, others keep serving traffic. A Deployment keeps the desired number of pods running, and we roll out changes gradually so a bad version doesn‚Äôt break everyone at once.'"
          ></textarea>

          <div class="apo-checklist">
            <p class="apo-label small">Before you lock, confirm you have:</p>
            <label class="apo-check">
              <input type="checkbox" id="chk-traffic" />
              <span>I described how user traffic reaches the app (Service / ingress / entry point).</span>
            </label>
            <label class="apo-check">
              <input type="checkbox" id="chk-workloads" />
              <span>I explained how workloads are managed (pods, deployments, replicas in concept).</span>
            </label>
            <label class="apo-check">
              <input type="checkbox" id="chk-health" />
              <span>I mentioned how we know if something is healthy or not (health checks / probes).</span>
            </label>
            <label class="apo-check">
              <input type="checkbox" id="chk-failure" />
              <span>I identified at least one failure mode and what users would experience.</span>
            </label>
          </div>

          <button id="btn-lock-explanation" class="apo-btn primary full">
            ‚úÖ Lock Explanation & Copy to Clipboard
          </button>

          <p id="explanation-status" class="apo-status small apo-muted">
            Explanation not locked yet.
          </p>
        </section>
      </section>

      <!-- COLUMN 3 ‚Äî LOG + NOTIFY -->
      <section class="apo-column">
        <section class="apo-card">
          <h2>3. Log your Level 1 attempt</h2>
          <p class="apo-muted small">
            After you‚Äôve written and locked your explanation, record the outcome here.
            This log is for <strong>you and your instructor</strong>, not for show.
          </p>

          <label class="apo-label" for="result-notes">
            Result snapshot (summary)
          </label>
          <textarea
            id="result-notes"
            rows="4"
            placeholder="Example: 'Clear description of Services and Deployments. Unsure about how rollbacks are triggered; need to study that next.'"
          ></textarea>

          <div class="apo-selfcheck">
            <p class="apo-label small">Self-check (honest, not theatrical)</p>
            <label class="apo-check">
              <input type="checkbox" id="chk-clarity" />
              <span>Someone non-technical could follow my explanation of the cluster.</span>
            </label>
            <label class="apo-check">
              <input type="checkbox" id="chk-coverage" />
              <span>I covered traffic flow, workload management, and health checks.</span>
            </label>
            <label class="apo-check">
              <input type="checkbox" id="chk-risk-aware" />
              <span>I acknowledged at least one realistic failure and its impact.</span>
            </label>
          </div>

          <label class="apo-label" for="iteration-count">
            How many drafts did you need?
          </label>
          <select id="iteration-count">
            <option value="">Select‚Ä¶</option>
            <option value="1">1 ‚Äî Nailed it on the first pass</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4-5">4‚Äì5</option>
            <option value="6-plus">6+ (I was wrestling with it)</option>
          </select>

          <label class="apo-label" for="reflection">
            Short reflection (where it actually got hard)
          </label>
          <textarea
            id="reflection"
            rows="4"
            placeholder="Example: I struggled to explain pods and deployments without using Kubernetes slang. Had to slow down and think in metaphors and outcomes."
          ></textarea>

          <button id="btn-submit-attempt" class="apo-btn primary full">
            Submit Level 1 Attempt (Local Log)
          </button>

          <p id="attempt-status" class="apo-status small">
            No attempts logged yet.
          </p>

          <!-- CERTIFICATION REVIEW -->
          <div class="apo-cert-block">
            <hr class="apo-divider" />
            <h3>Certification Review</h3>
            <p class="apo-muted small">
              When you believe Level 1 is complete, notify the instructor for review.
              Certification is issued only after manual validation.
            </p>

            <button
              id="btn-notify-instructor"
              class="apo-btn ghost full"
              disabled
            >
              üì© Notify Instructor for Certification Review
            </button>

            <p id="cert-status" class="apo-status small apo-muted">
              Certification request not sent.
            </p>
          </div>
        </section>

        <section class="apo-card small">
          <div class="apo-card-header">
            <h3>Attempt history (this browser)</h3>
            <button id="btn-copy-log" class="apo-btn ghost small">
              üìã Copy log
            </button>
          </div>
          <p class="apo-muted small">
            This is your Kubernetes reasoning trail. Instructors use this to see
            how you think about clusters, not just which commands you remember.
          </p>
          <ul id="attempt-list" class="apo-attempts">
            <li class="apo-muted small">No attempts yet.</li>
          </ul>
        </section>
      </section>
    </main>

    <footer class="apo-footer">
      <span>Flame Division Academy ¬∑ Kubernetes Workflow Operator ¬∑ Level 1</span>
      <span>Local-only ¬∑ No backend ¬∑ Real systems thinking practice</span>
    </footer>
  </div>

  <script>
    (function () {
      const TTS = {
        enabled: true,
        synth: "speechSynthesis" in window ? window.speechSynthesis : null,
        utterance: null,
      };

      function speak(text) {
        if (!TTS.enabled || !TTS.synth || !text) return;
        try {
          if (TTS.utterance) {
            TTS.synth.cancel();
          }
          const u = new SpeechSynthesisUtterance(text);
          u.rate = 1;
          u.pitch = 1;
          TTS.utterance = u;
          TTS.synth.speak(u);
        } catch (e) {
          // fail silently
        }
      }

      const btnTtsToggle = document.getElementById("btn-tts-toggle");
      const btnPlayBrief = document.getElementById("btn-play-brief");
      const statusChip = document.getElementById("session-state");

      if (btnTtsToggle) {
        btnTtsToggle.addEventListener("click", () => {
          TTS.enabled = !TTS.enabled;
          btnTtsToggle.textContent = TTS.enabled ? "üîä TTS: ON" : "üîá TTS: OFF";
        });
      }

      if (btnPlayBrief) {
        btnPlayBrief.addEventListener("click", () => {
          speak(
            "You are responsible for a microservice application running on a Kubernetes cluster. Your job is to explain how traffic flows, how workloads are kept running, and what happens when something fails."
          );
        });
      }

      // EXPLANATION LOCK
      const explanationInput = document.getElementById("explanation-input");
      const explanationStatus = document.getElementById("explanation-status");
      const btnLockExplanation = document.getElementById("btn-lock-explanation");

      const chkTraffic = document.getElementById("chk-traffic");
      const chkWorkloads = document.getElementById("chk-workloads");
      const chkHealth = document.getElementById("chk-health");
      const chkFailure = document.getElementById("chk-failure");

      function setExplanationStatus(msg, kind) {
        if (!explanationStatus) return;
        explanationStatus.textContent = msg;
        explanationStatus.classList.remove("good", "bad");
        if (kind) explanationStatus.classList.add(kind);
      }

      if (btnLockExplanation && explanationInput) {
        btnLockExplanation.addEventListener("click", async () => {
          const text = (explanationInput.value || "").trim();
          if (!text) {
            setExplanationStatus("Write your explanation before locking.", "bad");
            speak("Write your explanation before you lock it.");
            return;
          }

          if (!chkTraffic.checked || !chkWorkloads.checked || !chkHealth.checked || !chkFailure.checked) {
            setExplanationStatus(
              "Check all four boxes before locking. You must cover traffic, workloads, health, and failure.",
              "bad"
            );
            speak(
              "You must confirm that you covered traffic flow, workloads, health, and failure before locking."
            );
            return;
          }

          explanationInput.readOnly = true;
          explanationInput.classList.add("locked");

          try {
            await navigator.clipboard.writeText(text);
            setExplanationStatus("Explanation locked and copied to clipboard.", "good");
            speak("Explanation locked and copied. Use this as your reasoning baseline.");
          } catch (e) {
            setExplanationStatus(
              "Explanation locked. Copy it manually if needed.",
              "good"
            );
            speak("Explanation locked. Copy it manually if needed.");
          }

          if (statusChip) {
            statusChip.textContent = "STATE: Level 1 in progress ¬∑ Explanation locked";
          }
        });
      }

      // ATTEMPT LOGGING
      const resultNotesEl = document.getElementById("result-notes");
      const chkClarity = document.getElementById("chk-clarity");
      const chkCoverage = document.getElementById("chk-coverage");
      const chkRiskAware = document.getElementById("chk-risk-aware");
      const iterationSelect = document.getElementById("iteration-count");
      const reflectionEl = document.getElementById("reflection");
      const btnSubmitAttempt = document.getElementById("btn-submit-attempt");
      const attemptStatus = document.getElementById("attempt-status");
      const attemptList = document.getElementById("attempt-list");
      const btnCopyLog = document.getElementById("btn-copy-log");
      const notifyBtn = document.getElementById("btn-notify-instructor");
      const certStatus = document.getElementById("cert-status");

      const STORAGE_KEY = "fda_kwo_l1_attempts";
      const PASS_FLAG_KEY = "fda_kwo_l1_passed";

      let attempts = [];

      function loadAttempts() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          attempts = raw ? JSON.parse(raw) : [];
        } catch (e) {
          attempts = [];
        }
      }

      function saveAttempts() {
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(attempts));
        } catch (e) {
          // ignore
        }
      }

      function setAttemptStatus(msg, kind) {
        if (!attemptStatus) return;
        attemptStatus.textContent = msg;
        attemptStatus.classList.remove("good", "bad");
        if (kind) attemptStatus.classList.add(kind);
      }

      function renderAttempts() {
        if (!attemptList) return;
        if (!attempts.length) {
          attemptList.innerHTML = '<li class="apo-muted small">No attempts yet.</li>';
          return;
        }

        const items = attempts
          .slice()
          .reverse()
          .map((a) => {
            const date = new Date(a.timestamp);
            const time = date.toLocaleString();
            const statusLabel = a.passed ? "PASS" : "NEEDS REVIEW";
            const statusClass = a.passed ? "good" : "bad";
            const checks = [];
            if (a.checkClarity) checks.push("Clarity");
            if (a.checkCoverage) checks.push("Coverage");
            if (a.checkRiskAware) checks.push("Risk-aware");
            const checksLabel = checks.length ? checks.join(" ¬∑ ") : "No self-checks";

            return `
              <li>
                <strong>Kubernetes Workflow Operator ‚Äî Level 1</strong>
                <div class="small apo-muted">${time}</div>
                <div class="small apo-status ${statusClass}">Status: ${statusLabel}</div>
                <div class="small apo-muted">Drafts: ${a.iterations || "?"}</div>
                <div class="small">${checksLabel}</div>
                <div class="small apo-muted">${a.resultNotes || ""}</div>
                <div class="small apo-muted">${a.reflection || ""}</div>
              </li>
            `;
          })
          .join("");

        attemptList.innerHTML = items;
      }

      if (btnSubmitAttempt) {
        btnSubmitAttempt.addEventListener("click", () => {
          const explanationLocked = explanationInput && explanationInput.readOnly;
          if (!explanationLocked) {
            setAttemptStatus(
              "Lock your explanation first. Level 1 is about committed reasoning, not endless drafting.",
              "bad"
            );
            speak("Lock your explanation before logging the attempt.");
            return;
          }

          const resultNotes = (resultNotesEl.value || "").trim();
          const reflection = (reflectionEl.value || "").trim();
          const iterations = iterationSelect.value || "";

          if (!resultNotes) {
            setAttemptStatus("Add a brief result summary before submitting.", "bad");
            return;
          }

          if (!iterations) {
            setAttemptStatus("Select how many drafts it took.", "bad");
            return;
          }

          const passed =
            !!chkClarity.checked &&
            !!chkCoverage.checked &&
            !!chkRiskAware.checked &&
            reflection.length >= 30;

          const attempt = {
            level: "KWO-L1",
            resultNotes,
            checkClarity: !!chkClarity.checked,
            checkCoverage: !!chkCoverage.checked,
            checkRiskAware: !!chkRiskAware.checked,
            iterations,
            reflection,
            passed,
            timestamp: Date.now(),
          };

          attempts.push(attempt);
          saveAttempts();
          renderAttempts();

          if (passed) {
            try {
              localStorage.setItem(PASS_FLAG_KEY, "true");
            } catch (e) {}
            setAttemptStatus(
              "Attempt logged and marked as PASS for Level 1 (pending instructor review).",
              "good"
            );
            speak("Attempt recorded and marked as pass. An instructor will still review before certification.");
            if (notifyBtn) {
              notifyBtn.disabled = false;
              notifyBtn.classList.remove("ghost");
              notifyBtn.classList.add("primary");
            }
          } else {
            setAttemptStatus(
              "Attempt logged, but flagged for review. Strengthen your reasoning and try again.",
              "bad"
            );
            speak("Attempt recorded, but not auto-passed. Strengthen your coverage and reflection before trying again.");
          }
        });
      }

      if (btnCopyLog) {
        btnCopyLog.addEventListener("click", async () => {
          if (!attempts.length) {
            setAttemptStatus("No attempts to copy yet.", "bad");
            return;
          }
          const lines = attempts.map((a) => {
            const date = new Date(a.timestamp).toISOString();
            return [
              `Level: ${a.level}`,
              `Timestamp: ${date}`,
              `Drafts: ${a.iterations}`,
              `PASS: ${a.passed}`,
              `Clarity: ${a.checkClarity}`,
              `Coverage: ${a.checkCoverage}`,
              `Risk-aware: ${a.checkRiskAware}`,
              `Result: ${a.resultNotes}`,
              `Reflection: ${a.reflection}`,
              `---`,
            ].join("\n");
          });
          const text = lines.join("\n");
          try {
            await navigator.clipboard.writeText(text);
            setAttemptStatus("Attempt log copied to clipboard.", "good");
          } catch (e) {
            setAttemptStatus("Unable to copy automatically. Select and copy manually.", "bad");
          }
        });
      }

      // CERTIFICATION NOTIFY
      if (notifyBtn) {
        notifyBtn.addEventListener("click", async () => {
          const latest = attempts[attempts.length - 1];
          const explanationText = (explanationInput.value || "").trim();

          const payload =
`FLAME DIVISION ACADEMY ‚Äî CERTIFICATION REVIEW REQUEST

Track:
Kubernetes Workflow Operator ‚Äî Level 1 (Cluster Reasoning)

Latest Attempt:
PASS: ${latest?.passed ? "true" : "false"}
Drafts: ${latest?.iterations || "N/A"}
Timestamp: ${latest ? new Date(latest.timestamp).toISOString() : "N/A"}

Result Summary:
${latest?.resultNotes || "N/A"}

Reflection:
${latest?.reflection || "N/A"}

Locked Explanation:
${explanationText || "N/A"}

Submitted from:
Local KWO-L1 Dojo`;

          try {
            await navigator.clipboard.writeText(payload);
            if (certStatus) {
              certStatus.textContent =
                "‚úÖ Certification request copied. Send this to your instructor.";
              certStatus.classList.remove("bad");
              certStatus.classList.add("good");
            }
            speak("Certification request copied. Send it to your instructor for review.");
          } catch (e) {
            if (certStatus) {
              certStatus.textContent =
                "‚ö† Unable to copy automatically. Please manually share your log.";
              certStatus.classList.remove("good");
              certStatus.classList.add("bad");
            }
          }
        });
      }

      // init
      loadAttempts();
      renderAttempts();
    })();
  </script>

  <!-- Ninja gate -->
 <script>
  (function () {
    const ACCESS_TOKEN = "FLAME_DUAL_L1";    // üîë must match gate.html
    const STORAGE_KEY = "flame_dual_l1_access";

    let current;
    try {
      current = sessionStorage.getItem(STORAGE_KEY);
    } catch (err) {
      current = null;
    }

    if (current !== ACCESS_TOKEN) {
      var pathParts = window.location.pathname.split("/");
      var fileName = pathParts[pathParts.length - 1] || "awo-level1.html";
      var query = window.location.search || "";
      var target = encodeURIComponent(fileName + query);

      window.location.href = "gate.html?target=" + target;
    }
  })();
</script>
</body>
</html>
